# chatgpt-connect-doc

# Description
- Chatgpt-connect is a chrome extension that allows you to connect with chatgpt outside the browser. It allows you to integrate chatgpt in your application in an easy way without having to purchase any api-key. 

# Installation 
- To use chatgpt-connect you need to :
	1. install the chrome extension
	2. Start a websocket server
	3. Enjoy !!

# In details
- The way chatgpt-connect work is by connecting to a local websocket server. The websocket server should manage the way chatgpt-connect  and your application communiate. For now, the server should be starting on the port 1956 (basically : ws://localhost:1956).

![websocket server](./websocket%20server.png)

- When the server is up running, the chrome extension will connect to the server and then will immediately send a message indicating that it is chatgpt, the message looks like `{clientID : "chatgpt"}` .Then, it's up to the logic of websocket server to manage the exchange of message between applications and chatgpt-connect.

# Messages for different purposes 
- Chatgpt-connect accept different messages for different purposes. Those are the types of messages chatgpt-connect accept : 
	1. All message should include  `source` and `destination` (necessary : `chatgpt`) keys like this :
		```json
		{
			'source' : 'name of the sender of the message',
			destination : 'chatgpt'
		}
		```
	2. To ask chatgpt: 
		```json
		{
			source : "name of the sender of the message",
			destination : "chatGPT",
			conversation : {
				question : 'your question',
				conversationId : 'conversation id or undefined',
				parentMessageId : 'parentMessage id or undefined',
				deleteAfterFinished : 'Boolean : either true or false'
			}
		}
		```
		
	3. Explanation of the keys :
		1. `question` : is question you want to ask chatgpt.
		2. `conversationId` : each converation with chatgpt has an id, so if you want to target a conversation you already started with chatgpt you have to include its id, but remember, when you do that you have to also include the parentMessageId.
		3. `parentMessageId` : is an id generated by chatgpt to keep tarck of conversation, when ask chatgpt a question it will generate that id (will be returned in the answer) but when you ask it in the next time and in order to keep the same conversation you must include parentMessageId of the previous message.
		4. `deleteAfterFinished` : used to delete the whole conversation after you retrieve the answer.
	4. To assign a title to the a conversation :
		```json
		{
			"source": "name of the sender of the message",
			"destination" : "chatGPT",
			"conversation" : {
				"conversationId" : "should necessary include a valid conversation id",
				"title" : "The title you want to assign"
			}
		}
		```

# The answer form 
 - The form the answer is the following : 
	```json
	{
		answer : {
		  conversationData : {
		  text: "the part of the answers",
		  messageId: "the message id",
		  conversationId: "the conversation id"
		Â  }
		},
	Â  Â  error : '',
	Â  Â  done : "either true or false",
	Â  Â  source : "chatGPT",
	Â  Â  destination : "The sender of the question"
	
	}
	```

- Explanation of the keys in the answer :
	1. `text` : is portions of the answer, the generated answer comes in portions.
	2. `messageId` : is the id of the generated answer.
	3. `conversationId` : is the id of the conversation, if you specify an id for the conversation when you send the question it will remain the same, if you didn't specify the conversation id chatgpt will generated one for your conversation.
	4. `error` : a message indicating that an error occured while or before generating the answer.
	5. `done` : tells you about the current state of the answer, if false means the answer is not complete yet,else it tells you that the answer is complete.
	6. `source` : is always 'chatgpt'.
	7. `destination` : is the one who asked the question.

# Tutorial
- Here is an example of a websocket server that manage message exchange between different members (applications) and chatgpt :

```typescript
//Make sure to install 'ws' library : npm install ws
import WebSocket from 'ws';

function runServer() {
  //The port should necessarily be 1956 
Â  const bridge = new WebSocket.Server({ port: 1956 });
Â  const members: { [key: string]: WebSocket } = {};

Â  bridge.on('connection', (client: WebSocket) => {
Â  Â  client.on('message', (message: WebSocket.Data) => {
Â  Â  Â  const messageAsText = message.toString();
Â  Â  Â  const data = JSON.parse(messageAsText);

Â  Â  Â  // Here we retrieve the identifier of the client
Â  Â  Â  const clientID: string = data.clientID;

Â  Â  Â  // Those are the data related to the question
Â  Â  Â  const source: string = data.source;
Â  Â  Â  const destination: string = data.destination;
Â  Â  Â  const conversation : string = data.conversation;

Â  Â  Â  // Those are the data related to the answer
Â  Â  Â  const conversationData: any = data.conversationData;
Â  Â  Â  const error: any = data.error;
Â  Â  Â  const done: boolean = data.done;

Â  Â  Â  // The form of the answer
Â  Â  Â  const answer = {
Â  Â  Â  Â  conversationData: conversationData,
Â  Â  Â  Â  error: error,
Â  Â  Â  Â  done: done,
Â  Â  Â  };

Â  Â  Â  // When the client connects to the server, we add it to the members object in order
Â  Â  Â  // to direct the messages that correspond to it.

Â  Â  Â  if (clientID) {
Â  Â  Â  Â  members[clientID] = client;
Â  Â  Â  } else {
Â  Â  Â  Â  const target = members[destination];
Â  Â  Â  Â  if (target.readyState === WebSocket.OPEN) {
Â  Â  Â  Â  Â  const messageBody = {
Â  Â  Â  Â  Â  Â  source: source,
Â  Â  Â  Â  Â  Â  conversation : conversation,
Â  Â  Â  Â  Â  Â  answer: answer,
Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  target.send(JSON.stringify(messageBody));
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  });
Â  });
}

export default runServer;
```

- Let's suppose that we want to communicate with chatgpt from a website that we created. Let's follow those stepps :
	1. create the ui of our website (let's keep it basic for now) :
		```html
		<!DOCTYPE html>
		<html lang="en" style="height: 100%;">
		<head>
		Â  Â  <meta charset="UTF-8">
		Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
		Â  Â  <title>Chatgpt-connect</title>
		</head>
		<body style="display: flex;flex-direction: column;align-items: center;justify-content: center;height: 100%;">
		Â  Â  <div>
		Â  Â  Â  Â  <input type="text" name="" Â id="question" placeholder="write your question.."><button onclick="askChatgpt()">Send</button>
		Â  Â  </div>
		Â  Â  <div style="margin-top: 20px;">chatgpt-answer</div>
		Â  Â  <div style="width: 400px;max-height: 500px;min-height: 100px;border-style: solid;margin-top: 20px;border-radius: 13px;overflow-y: auto;padding: 10px;" id="answerArea"></div>
		</body>
		</html>
		```
	2. Let's connect to the server :  add the followig script tag to the website : 
	```html
	<script>
	Â  Â  const questionEle = document.getElementById('question');
	Â  Â  const answerArea = document.getElementById('answerArea');
	
	Â  Â  function askChatgpt(){
	Â  Â  Â  Â  const question = questionEle.value;
	Â  Â  Â  Â  const server = new WebSocket('ws://127.0.0.1:1956');
	Â  Â  Â  Â  server.onopen = async function(){
				//Here we tell the server that I'm connecting by this name : "applicationName" (no space accespted in the name)
	Â  Â  Â  Â  Â  Â  server.send(JSON.stringify({
	Â  Â  Â  Â  Â  Â  Â  Â  clientID : "applicationName"
	Â  Â  Â  Â  Â  Â  }))
	
				//Here we send the actual question to the server 
	Â  Â  Â  Â  Â  Â  server.send(JSON.stringify({
	Â  Â  Â  Â  Â  Â  Â  Â  conversation : {question : question},
	Â  Â  Â  Â  Â  Â  Â  Â  source : "applicationName",
	Â  Â  Â  Â  Â  Â  Â  Â  destination : 'chatGPT'
	Â  Â  Â  Â  Â  Â  }))
	
				//Here we listen for the upcomming messages
	Â  Â  Â  Â  Â  Â  server.onmessage = async function(msg){
	Â  Â  Â  Â  Â  Â  Â  Â  //Take a look at the console to see the form of the answer
	Â  Â  Â  Â  Â  Â  Â  Â  console.debug(msg.data);
	
	Â  Â  Â  Â  Â  Â  Â  Â  //The whole message received
	Â  Â  Â  Â  Â  Â  Â  Â  const data = JSON.parse(msg.data);
	
	Â  Â  Â  Â  Â  Â  Â  Â  //The data related to the answer :
	Â  Â  Â  Â  Â  Â  Â  Â  const answerData = data.answer;
	
	Â  Â  Â  Â  Â  Â  Â  Â  //The data related to the conversation
	Â  Â  Â  Â  Â  Â  Â  Â  const conversationData = answerData.conversationData;
	
	Â  Â  Â  Â  Â  Â  Â  Â  //The actual answer's portions :
	Â  Â  Â  Â  Â  Â  Â  Â  const answer = conversationData.text;
	
	Â  Â  Â  Â  Â  Â  Â  Â  answerArea.innerText = answer;
	Â  Â  Â  Â  Â  Â  Â  Â  answerArea.scrollBy(0,answerArea.scrollHeight);
	Â  Â  Â  Â  Â  Â  }
	Â  Â  Â  Â  }
	Â  Â  }
	
	</script>
	```

- **Notes :** 
	1. Make sure that the server is running
	2. Make sure that chatgpt-connect is connected to the server (the logo will be green if connected else it will be white).
	3. Make sure to experiment with the extension.
	4. The important thing is to enjoy what you do ðŸ˜Š.

# Limitations :
- You could don't stop generating an answer.
- You couldn't ask chatgpt to continue answering an incomplete answer (appears when the answer of chatgpt is too long).
- You couldn't ask chatgpt for multiple questions at the same time.
- Due to the expiry date of sessions' tokens you have to login to your account after the expiry day finished.
